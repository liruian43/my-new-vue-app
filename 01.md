# 通用流程模拟与配置系统（MultiStep Configurator）需求文档

## 第一章：项目概述

### 1.1 项目名称
**通用流程模拟与配置系统（MultiStep Configurator）**

### 1.2 核心目标
开发一个由后台驱动、前端负责交互执行的模块化流程模拟系统。

- 支持任意行业模板配置（如医食结合、工业流程、教学计划等）
- 通过定义“标准答案”与“模糊匹配规则”，实现智能推荐
- 前端作为运行时交互界面，具备完整的用户操作能力：
  - 字段选择
  - 预设切换
  - 参数输入
  - 结果生成
- 前端**不参与任何模板配置、字段定义或规则编写**
- 所有配置均由后台完成

支持多种字段类型：
- 复选框
- 下拉菜单
- 数值输入
- 文本输入等

模板设计者可在后台定义若干“标准答案”，其余组合自动匹配最接近的标准答案。

支持 JSON 文件导入/导出模板配置，可本地保存多个行业的完整配置文件，便于备份、分享和跨行业适配。

### 1.3 应用场景
- 厨房食谱推荐
- 医疗护理方案
- 工业流程配置
- 教育教学计划
- 商业决策辅助
- 任意需要多条件组合、输出推荐结果的领域

---

## 第二章：核心功能需求

### 2.1 多单元模块化结构
- 页面显示多个独立单元（数量可变，如6~10个）
- 每个单元包含多种类型的字段（布尔型、数值型、单选、多选、文本等）
- 单元字段、选项、联动逻辑均可在后台配置
- 每个单元支持多个预设按钮（如甲、乙、丙）
- 单元增删、字段编辑、选项修改全部在后台完成

### 2.2 独立预设机制
- 每个单元提供一个下拉菜单形式的预设选择器（如：“清淡”、“快捷”、“高蛋白”等）
- 用户从下拉菜单中选择一个预设项 → 表示选择了该预设所代表的一个或几个“选项”
- 预设项可以仅表示一个语义标签（如“清淡”），也可以同时携带一些默认字段值（如 `cookTime: 10`, `isSpicy: false`）
- 当用户选择某个预设项时：
  - 自动勾选/激活该预设所代表的选项；
  - 如果该预设项包含默认字段值，则一并填充；
  - 否则，仅完成选项的勾选，其他字段保持不变；
- 所有预设信息由后台定义并通过接口返回给前端，前端只负责渲染与执行；

### 2.3 结果生成器
- 用户完成所有单元的选择后，点击“生成”按钮
- 系统查找是否有完全匹配的“标准答案”
- 若无匹配，则尝试匹配后台设定的“模糊推荐规则”
- 输出结果为文本、建议、推荐项等
- 所有规则由 JSON 数据驱动，不使用硬编码逻辑

### 2.4 自由组合 + 推荐逻辑
- 用户可在每个单元自由选择字段值
- 系统判断是否命中标准答案，若未命中则尝试推荐最接近的结果
- 后台需预先配置“相似度映射表”用于推荐逻辑
- 前端不参与推荐算法计算，只执行后台定义好的规则逻辑

### 2.5 数据驱动 UI
- 所有单元结构、字段类型、预设、规则均通过 JSON 定义
- 易于维护、扩展、跨行业适配
- 新增功能：
  - 导出当前配置为 JSON 文件（备份或分享）
  - 导入 JSON 文件恢复整套配置（替代“行业模板切换”）

---

## 第三章：用户使用模式

### 3.1 快速选择预设版本
- 用户可在每个单元中选择一个预设（如清淡、快捷、高蛋白）
- 点击“生成” → 输出标准答案或推荐结果

### 3.2 自由组合参数
- 用户可单独修改每个单元的字段值（如布尔型、数值型、文本型、单选、多选等）
- 系统根据后台规则判断最终结果
- 若无匹配结果，则提示：“未找到匹配结果，请尝试其他组合” 或 “建议参考相近组合”

### 3.3 智能提示
- 当用户输入不在规则表中时，返回提示：
  - “您的选择偏向『版本A』，建议参考『版本A升级版』”
  - “这是最接近的组合，建议参考『果味清炒』”

### 3.4 配置保存与加载
- 用户点击“导出配置”按钮，系统将当前状态保存为 `.json` 文件
- 用户点击“导入配置”，上传该文件即可恢复上次设置
- 替代“行业模板切换”功能，只需导入对应行业的配置文件即可切换用途

### 3.5 初始引导行为（新增）
- 当用户首次访问前端页面或当前无可用模板时：
  - 不渲染任何单元或字段；
  - 显示提示信息：“当前无可用模板，请点击左上角‘进入后台’进行配置。”
  - 提供“进入后台”按钮作为唯一可操作项。

---

## 第四章：技术方向建议

### 4.1 主推方案：前后端分离架构

| 技术     | 描述 |
|----------|------|
| 前端     | HTML + CSS + JavaScript (ES6+) + Fetch API |
| 后台     | Node.js + Express（轻量级本地服务） |
| 存储     | JSON 文件 / SQLite（适合本地开发） |
| 通信方式 | RESTful API（JSON 格式） |

✅ **优势：**
- 前后端职责清晰，便于维护与扩展
- 易于未来迁移到 Web 服务
- 支持 Electron 打包为桌面程序

---

### 4.2 扩展方案：Electron 打包为桌面程序（EXE / Mac App / Linux）

| 特点             | 描述 |
|------------------|------|
| 更像软件         | 具备桌面应用体验 |
| 可加密保护 JS 文件 | 防止源码泄露 |
| 离线运行         | 无需联网即可使用 |
| 可发布为 U盘安装版 | 方便部署和分发 |

---

### 4.3 其他备选方向

| 方向               | 是否推荐 | 说明 |
|--------------------|----------|------|
| React/Vue 开发     | ❌ 暂时不推荐 | 轻量级更合适 |
| 移动 App（Android/iOS） | ❌ 暂时不推荐 | 无移动端需求 |
| Web 服务部署       | ⚠️ 可选 | 未来可考虑，需搭建服务器环境 |

---

## 第五章：前后端架构设计

### 5.1 项目结构建议（带后台）

```bash
project/
├── frontend/
│   ├── index.html                 ← 页面入口
│   ├── main.js                    ← 前端主逻辑
│   ├── utils.js                   ← 工具函数库
│   ├── apiClient.js               ← 与后台通信封装
│   ├── ResultEngine.js            ← 结果生成引擎
│   ├── Recommender.js             ← 推荐逻辑处理
│   └── styles.css                 ← 样式文件

├── backend/
│   ├── server.js                  ← 启动服务器
│   ├── routes/
│   │   ├── unitRoutes.js          ← 单元管理接口
│   │   ├── presetRoutes.js        ← 预设相关接口
│   │   └── configRoutes.js        ← 配置相关接口
│   ├── models/
│   │   ├── UnitModel.js           ← 单元模型定义
│   │   └── PresetModel.js         ← 预设模型定义
│   └── db/
│       └── templates/             ← 存放多个 JSON 模板
│           ├── kitchen.json
│           ├── healthcare.json
│           └── education.json

└── package.json                   ← Node.js 项目描述
```

### 5.2 前端调用示例（main.js）

```javascript
// 获取所有单元
fetch('/api/unit/all')
  .then(res => res.json())
  .then(units => {
    // 渲染到页面
  });

// 添加新单元
fetch('/api/unit/add', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ title: '新单元' })
})
.then(res => res.json())
.then(() => location.reload());
```

### 5.3 后台接口示例（unitRoutes.js）

```javascript
const express = require('express');
const router = express.Router();
const fs = require('fs');
const path = require('path');

const CONFIG_PATH = path.join(__dirname, '../db/templates/kitchen.json');

router.get('/all', (req, res) => {
  const data = JSON.parse(fs.readFileSync(CONFIG_PATH));
  res.json(data.units);
});

router.post('/add', (req, res) => {
  const data = JSON.parse(fs.readFileSync(CONFIG_PATH));
  const newUnit = {
    id: `unit${data.units.length + 1}`,
    title: req.body.title || `单元${data.units.length + 1}`,
    fields: [],
    presets: {}
  };
  data.units.push(newUnit);
  fs.writeFileSync(CONFIG_PATH, JSON.stringify(data, null, 2));
  res.json({ success: true });
});
```

### 5.4 前后端跳转接口设计

#### 前端 → 后台跳转
- 在前端左上角固定位置设置“进入后台”按钮；
- 点击后跳转至 `/admin` 路径（假设为后台首页）；
- 若部署于 Electron 中，可通过 `window.location.href = '/admin'` 实现跳转。

#### 后台 → 前端跳转
- 在后台左上角相同位置添加“返回前台”按钮；
- 点击后跳转至 `/` 或前端主路径；
- 该按钮始终可见，便于用户随时切换回执行界面。

---

## 第六章：用户使用指南

### 6.1 前端操作说明
前端是一个完整的运行时交互界面，用户可以进行以下操作：

- 选择预设项（如“清淡”、“快捷”、“高蛋白”）
- 修改字段值（如布尔型、数值型、文本型、单选、多选等）
- 查看字段联动效果（由后台规则控制）
- 点击“生成”按钮触发结果推荐
- 导出当前配置为 `.json` 文件用于备份或分享
- 导入已有配置文件以恢复设置

⚠️ **注意：**
虽然前端具备完整交互能力，但它不能修改模板结构、字段定义或规则逻辑，所有配置必须通过后台完成。

---

## 第七章：Electron 架构与打包指南

### 7.1 Electron 项目结构（支持前后端一体打包）

```bash
project/
├── app/
│   ├── index.html
│   ├── main.js (前端)
│   └── styles.css
├── backend/
│   ├── server.js
│   └── db/
│       └── templates/
├── electron-main.js     ← Electron 主进程逻辑
├── package.json         ← 应用描述 + 构建脚本
└── build/               ← 构建输出目录
```

### 7.2 推荐工具
- `electron-packager`
- `electron-builder`
- `vite-electron-plugin`（用于 Vite + Electron 集成）

---

## 第八章：安全与保护建议

### 8.1 JS 代码混淆技巧
- 使用 `UglifyJS` 或 `JavaScript Obfuscator`
- 对关键逻辑模块进行混淆处理

### 8.2 加密 JSON 配置文件方法
- 使用 AES 加密 JSON 数据文件
- 在运行时解密加载

### 8.3 防止反编译策略（进阶）
- 使用原生 Node.js 模块封装核心逻辑
- 使用 `node-gyp` 编译 C++ 插件
- 使用 `pkg` 将整个 Node.js 项目打包为二进制文件

---

## 第九章：后续扩展方向（选读）

| 功能           | 描述 |
|----------------|------|
| 权重评分机制   | 给不同单元设置不同权重，提升推荐准确性 |
| 标签匹配推荐   | 根据用户选择的关键词（如‘健康’、‘快捷’）推荐对应风格的版本 |
| AI 辅助推荐    | 引入机器学习模型，自动归纳新组合趋势，推荐未知结果 |
| 版本演化图谱   | 可视化展示版本之间的演变关系（基础版 → 加强版 → 超级版） |
| 多语言支持     | 添加英文、日文等多语言界面 |
| 版本历史记录   | 自动保存每次导出的配置，方便回溯 |

---

## 总结 🧾

你现在拥有的是一个高度模块化、灵活配置、前后端分离、易于打包发布的流程模拟系统解决方案：

| 特性         | 描述 |
|--------------|------|
| 🔧 前端定位   | 运行时交互界面，具备完整的用户操作能力（选择、填写、生成结果），但不可修改模板或规则 |
| 👨‍💻 后台定位 | 模板设计器，完全自由定制流程结构、字段、预设、规则 |
| 📦 数据格式   | 所有模板和配置用 JSON 存储和传输 |
| 🧠 推荐机制   | 所有模糊匹配规则由后台定义，前端只执行 |
| 💻 打包能力   | 可打包为桌面程序，支持加密与离线运行 |
| 🌐 扩展潜力   | 支持未来接入 Web 服务、AI 推荐、权限系统等 |
| ⚠️ 初始引导   | 无模板时不显示任何内容，提示用户前往后台配置 |
| ↔️ 导航闭环   | 前端与后台页面均有相互跳转按钮，提升用户体验 |

--- 