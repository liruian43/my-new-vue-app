# 系统标准化规范手册  
## （基于模块职责的ID生成、数据存储与交互规则）  


### 1. 引言  
#### 1.1 目的  
本文明确系统各模块在ID生成、数据存储、规则定义及交互过程中的标准化要求，确保全系统数据格式统一、交互逻辑一致，为问题排查和责任界定提供依据。  

#### 1.2 适用范围  
覆盖系统所有模块：`root_admin模式区`、`环境配置区`、`题库区`、`联动区`、`其他模式`、`匹配反馈区`。  


### 2. 核心模块职责与标准化边界  
| 模块               | 核心职责                                  | 标准化边界（必须遵守的规则）                          |  
|--------------------|-----------------------------------------|---------------------------------------------------|  
| **root_admin模式区** | 制定标准源头，生成全局维护全局唯一的ID规则         | 1. 垄断卡片标识、选项完整ID的生成逻辑<br>2. 定义全系统通用的数据格式标准（如空值用`null`） |  
| **环境配置区**       | 存储全维护全量基础信息（卡片、选项的三要素）       | 1. 严格按root_admin定义的ID存储数据<br>2. 选项必须包含`name/value/unit`三要素 |  
| **题库区**           | 定义ID组合的关系规则（表达式）及用户自定义结果       | 1. 表达式必须使用环境配置区的完整ID（如`A1+B2→`）<br>2. 结果按类型标准化存储（文本/图片等） |  
| **联动区**           | 负责标准化数据的同步与授权控制                   | 1. 同步数据必须符合环境配置区格式<br>2. 授权规则基于ID前缀过滤（如仅允许同步`A`开头的卡片） |  
| **其他模式**         | 解析标准化数据，转换为自身UI可识别的格式           | 1. 不得修改原始标准化数据<br>2. 解析结果必须可逆（可还原为标准格式） |  
| **匹配反馈区**       | 基于标准化规则生成最终结果（如“倚天剑”）           | 1. 必须使用题库区的表达式规则匹配<br>2. 结果展示需关联原始ID对应的信息 |  


### 3. 核心数据格式标准  
#### 3.1 ID生成标准（由root_admin模式区定义）  
| 类型         | 格式规则                                                                 | 示例       | 生成方法                          |  
|--------------|----------------------------------------------------------------------|-----------|-------------------------------|  
| 卡片标识       | 纯大写字母，从`A`开始递增（A→B→...→Z→AA→AB...）                          | A、B、AA  | `generateCardId(lastId)`      |  
| 选项完整ID    | 卡片标识+阿拉伯数字（数字从1开始递增，删除后不补位）                           | A1、B2、AA3 | `generateOptionId(cardId)`    |  


#### 3.2 环境配置区存储标准  
##### 3.2.1 卡片数据格式  
```javascript
{
  "[卡片标识]": {  // 键为root_admin生成的卡片标识（如"A"）
    "id": "[卡片标识]",  // 与键一致（如"A"）
    "name": "[卡片名称]",  // 用户输入（如"材料"）
    "dropdown": ["[选项名称列表]"  // 下拉选项的名称集合（如["玄铁", "青铜"]）
  }
}
```  
- 禁止新增非标准字段（如`title`代替`name`）。  

##### 3.2.2 选项数据格式  
```javascript
{
  "[完整ID]": {  // 键为root_admin生成的完整ID（如"A1"）
    "name": "[选项名称]",  // 可选，默认为null（如"玄铁"）
    "value": "[选项值]",   // 可选，默认为null（如"5"）
    "unit": "[选项单位]"   // 可选，默认为null（如"kg"）
  }
}
```  
- 空值必须用`null`，禁止用空字符串或`undefined`。  


#### 3.3 题库区存储标准  
##### 3.3.1 表达式格式  
- 必须使用`[完整ID][运算符][完整ID]→`格式，支持多运算符（+、-、*等）。  
- 示例：`A1+B2→`、`A1*C3-B2→`。  

##### 3.3.2 结果存储格式  
```javascript
{
  "id": "q[数字]",  // 题库内部唯一标识（如"q1"）
  "expression": "[表达式]",  // 如"A1+B2→"
  "result": {
    "type": "[类型]",  // 支持text/image/animation（如"text"）
    "content": "[内容]"  // 对应类型对应的数据（如"倚天剑"、"/images/sword.png"）
  }
}
```  


### 4. 接口与数据流转规范  
#### 4.1 模块间交互接口（必须通过以下接口传递数据）  
| 调用方         | 被调用方         | 接口名称                  | 输入参数格式                  | 输出格式                    |  
|----------------|------------------|-------------------------|---------------------------|-------------------------|  
| 环境配置区      | root_admin模式区  | `generateCardId()`      | -                         | 新卡片标识（如"AA"）       |  
| 环境配置区      | root_admin模式区  | `generateOptionId(cardId)` | 卡片标识（如"A"）            | 新选项完整ID（如"A3"）      |  
| 题库区          | 环境配置区        | `getOptionByFullId(fullId)` | 完整ID（如"A1"）            | 选项三要素（{name, value, unit}） |  
| 联动区          | 环境配置区        | `getAllOptionsByCardId(cardId)` | 卡片标识（如"B"）            | 该卡片下所有选项数组         |  
| 其他模式        | 联动区            | `syncData(cardIdList)`   | 需同步的卡片标识列表（如["A", "B"]） | 符合环境配置格式的数据       |  


#### 4.2 数据流转规则  
1. **ID流转**：所有卡片/选项ID必须由root_admin生成，其他模块不得自行生成ID（如禁止手动输入"A1"作为ID）。  
2. **存储流转**：环境配置区的卡片/选项数据修改后，必须同步通知联动区同步，确保其他模式获取最新标准数据。  
3. **规则流转**：题库区的表达式修改后，需通知联动区更新同步规则，避免其他模式使用旧规则。  


### 5. 合规性校验规则（错误定位问题）  
| 违规场景                          | 责任模块    | 校验错依据                                  |  
|---------------------------------|---------|-----------------------------------------|  
| 出现非root_admin生成的ID（如"1A"）   | 生成该ID的模块 | 违反3.1节ID生成标准                          |  
| 选项缺少`name/value/unit`三要素之一   | 环境配置区  | 违反3.2.2节选项格式标准                       |  
| 题库表达式使用不存在的ID（如"A99"）   | 题库区     | 违反3.3.1节表达式格式，且环境配置区无该ID对应的选项   |  
| 联动区同步的数据缺少`unit`字段        | 联动区     | 违反4.2节存储流转规则，未同步完整同步环境配置区数据 |  
| 其他模式展示的选项名称与环境配置区不一致 | 其他模式    | 违反2.5节职责，未正确同步后的数据解析               |  


### 6. 规范维护与修订  
- 本规范由root_admin模式区的维护者负责更新。  
- 修订改需经所有模块负责人确认，修订记录需包含“修订原因、影响模块、生效时间”。  
- 规范版本冲突时，以本规范为准，特殊场景需记录例外常情况及原因。  


**生效日期**：2024-08-14  
**修订记录**：初始版本