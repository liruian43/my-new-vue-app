# ID 生成逻辑集中化改造日志

## 改造背景
此前系统中的卡片ID生成逻辑分散在`cards.js`的多个函数中，主要依赖`store.generateCardId()`方法实现。这种分散式实现存在以下问题：
- ID生成规则不统一，不同功能生成的ID格式可能存在差异
- 难以维护和追溯ID生成逻辑的变更历史
- 跨文件复用ID生成逻辑时需要重复实现
- 存在潜在的ID冲突风险

## 改造目标
1. 将所有ID生成相关逻辑集中到专门的服务文件中
2. 统一ID生成规则，确保系统内ID唯一性
3. 简化ID生成逻辑的维护成本
4. 消除潜在的ID冲突问题

## 具体改造内容
1. 创建专用ID服务文件：`src/components/Data/services/id.js`，集中存放所有ID生成逻辑
2. 在`cards.js`中引入新服务：`import { generateNextCardId } from '../services/id.js'`
3. 实现`nextCardIdFromStore`辅助函数，负责收集系统中已使用的ID并调用集中化服务
4. 全面替换旧有ID生成方式：
   - 移除所有`store.generateCardId()`调用
   - 在`addCard`、`normalizeCardStructure`、`addTempCard`等函数中统一使用新的ID生成逻辑
5. 确保所有ID相关验证和冲突检查逻辑也同步集中化

## 改造后效果
- 所有ID生成逻辑集中管理，便于后续规则调整
- 统一的ID格式和生成规则，降低冲突概率
- 代码复用率提高，减少重复实现
- 故障排查更高效，所有ID相关问题可追溯至同一服务文件
- 新功能开发时可直接复用现有ID服务，无需重新设计

## 影响范围
- 卡片创建功能（`addCard`）
- 卡片结构标准化（`normalizeCardStructure`）
- 临时卡片创建（`addTempCard`）
- 所有依赖卡片ID唯一性的功能模块

## 注意事项
- 后续如需修改ID生成规则，只需调整`id.js`文件即可
- 新增需要生成唯一ID的功能时，必须使用此集中化服务
- 进行数据迁移或导入时，需确保外部ID符合当前生成规则

## 变更记录
- [日期] 完成ID生成逻辑集中化改造
- [日期] 优化已使用ID收集逻辑，增加对中期存储卡片的ID检测

---

